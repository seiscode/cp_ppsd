# PPSD配色方案配置说明

## 概述

本文档说明如何为PPSD标准图配置不同的配色方案，以满足不同的可视化需求和美学要求。

## 配色方案配置位置

配色方案在 `input/config_plot.toml` 文件中配置：

```toml
[plot_settings]
standard_cmap = "Set1"    # PPSD标准图的配色方案
```

## 百分位数线样式配置（新功能）

### 功能说明

除了配色方案外，现在还支持自定义百分位数线的样式，包括颜色、线宽、线型和透明度。这些线条显示PPSD数据的统计分布特征（通常是10%、50%、90%百分位数）。

### 配置参数

在 `config_plot.toml` 中添加以下参数：

```toml
# 百分位数线样式配置（自定义参数）
percentile_color = "lightgray"      # 百分位数线颜色
percentile_linewidth = 1.0          # 百分位数线宽度
percentile_linestyle = "-"          # 百分位数线样式 ("-", "--", "-.", ":")
percentile_alpha = 0.8              # 百分位数线透明度 (0.0-1.0)
```

### 参数详解

#### percentile_color（百分位数线颜色）
- **类型**: 字符串
- **默认值**: "lightgray"
- **可选值**: 
  - 颜色名称: "lightgray", "darkgray", "steelblue", "darkred" 等
  - 十六进制: "#808080", "#4682B4" 等
  - RGB元组: (0.5, 0.5, 0.5) 等
- **推荐**: "lightgray" 或 "darkgray"（不抢夺主图注意力）

#### percentile_linewidth（百分位数线宽度）
- **类型**: 浮点数
- **默认值**: 1.0
- **范围**: 0.5 - 3.0
- **推荐**: 
  - 0.8-1.0（细线，适合科学论文）
  - 1.2-1.5（中等线宽，适合演示）

#### percentile_linestyle（百分位数线样式）
- **类型**: 字符串
- **默认值**: "-"
- **可选值**:
  - "-": 实线
  - "--": 虚线
  - "-.": 点划线
  - ":": 点线
- **推荐**: "-"（实线，最清晰）

#### percentile_alpha（百分位数线透明度）
- **类型**: 浮点数
- **默认值**: 0.8
- **范围**: 0.0-1.0
- **说明**: 
  - 0.0: 完全透明（不可见）
  - 1.0: 完全不透明
- **推荐**: 0.7-0.9（略微透明，避免过于突出）

### 推荐配置组合

#### 1. 科学论文风格（推荐）
```toml
percentile_color = "lightgray"
percentile_linewidth = 1.0
percentile_linestyle = "-"
percentile_alpha = 0.8
```
**特点**: 低调、专业、不干扰主要数据

#### 2. 演示展示风格
```toml
percentile_color = "steelblue"
percentile_linewidth = 1.2
percentile_linestyle = "--"
percentile_alpha = 0.7
```
**特点**: 醒目、现代、易于识别

#### 3. 传统学术风格
```toml
percentile_color = "darkgray"
percentile_linewidth = 1.1
percentile_linestyle = "-"
percentile_alpha = 0.9
```
**特点**: 稳重、传统、清晰可见

### 使用注意事项

1. **必须启用百分位数线**: 确保 `show_percentiles = true`
2. **自动检测**: 只要配置了任一百分位数线样式参数，系统会自动使用自定义样式
3. **兼容性**: 与所有配色方案兼容
4. **性能**: 自定义样式不会影响绘图性能

### 测试工具

```bash
# 测试不同百分位数线样式
python tests/test_percentile_styles_simple.py
```

## 推荐配色方案

### 1. 自定义配色方案（新增 - 基于现有配色方案的优化版本）

#### 1.1 viridis_custom配色方案（强烈推荐 - 自定义连续配色）
- **配置**: `standard_cmap = "viridis_custom"`
- **特征**: Viridis自定义版本 - 去除深色部分，突出中高值
- **基础配色**: viridis (范围: 0.3-1.0)
- **适用场景**: 
  - 标准PPSD可视化首选
  - 突出高概率区域
  - 通用地震学数据分析
  - 科学论文和报告
- **优点**: 
  - 去除深色部分，提高可读性
  - 突出中高值数据
  - 连续渐变，符合科学标准
  - 基于成熟viridis配色，质量保证
- **缺点**: 可能丢失低值信息的细节
- **推荐指数**: ★★★★★

#### 1.2 ocean_custom配色方案（推荐 - 海洋主题）
- **配置**: `standard_cmap = "ocean_custom"`
- **特征**: Ocean水色配色 - 蓝绿色调，适合海洋数据
- **基础配色**: ocean (范围: 0.5-1.0)
- **适用场景**:
  - 海洋地震学研究
  - 水下噪声分析
  - 海洋环境监测
  - 蓝绿色调偏好
- **优点**: 蓝绿色调，海洋主题，视觉舒适，专业感强
- **缺点**: 色彩范围有限，可能不够鲜明
- **推荐指数**: ★★★★☆

#### 1.3 plasma_custom配色方案（推荐 - 现代科学可视化）
- **配置**: `standard_cmap = "plasma_custom"`
- **特征**: Plasma完整配色 - 紫-蓝-绿-黄-红渐变
- **基础配色**: plasma (范围: 0.0-1.0)
- **适用场景**:
  - 现代科学可视化
  - 高对比度需求
  - 演示和展示
  - 现代感强的报告
- **优点**: 完整色彩范围，现代感强，高对比度，感知均匀
- **缺点**: 可能过于鲜艳
- **推荐指数**: ★★★★☆

#### 1.4 ocean_r_custom配色方案（备选 - 学术论文）
- **配置**: `standard_cmap = "ocean_r_custom"`
- **特征**: Ocean反向配色 - 浅色到深色，优雅渐变
- **基础配色**: ocean_r (范围: 0.0-0.6)
- **适用场景**:
  - 学术论文
  - 正式报告
  - 打印输出
  - 保守的可视化需求
- **优点**: 浅色背景，优雅渐变，打印友好，对比度好
- **缺点**: 深色可能过暗
- **推荐指数**: ★★★★☆

#### 1.5 hot_r_custom配色方案（备选 - 教学演示）
- **配置**: `standard_cmap = "hot_r_custom"`
- **特征**: Hot反向配色 - 去除过亮部分，温暖色调
- **基础配色**: hot_r (范围: 0.0-0.8)
- **适用场景**:
  - 演示展示
  - 教学用途
  - 温暖色调偏好
  - 视觉吸引需求
- **优点**: 温暖色调，去除过亮部分，视觉吸引，对比度高
- **缺点**: 可能过于鲜艳，不够科学
- **推荐指数**: ★★★☆☆

#### 1.6 CMRmap_r_custom配色方案（备选 - 传统科学）
- **配置**: `standard_cmap = "CMRmap_r_custom"`
- **特征**: CMRmap反向配色 - 优化对比度，科学可视化
- **基础配色**: CMRmap_r (范围: 0.0-0.6)
- **适用场景**:
  - 传统科学可视化
  - 保守需求
  - 经典配色偏好
  - 专业认知需求
- **优点**: 科学标准，优化对比度，传统配色，专业认知
- **缺点**: 色彩单调，缺少变化
- **推荐指数**: ★★★☆☆

### 2. Set1配色方案（当前推荐 - 定性配色）
- **配置**: `standard_cmap = "Set1"`
- **特征**: 经典定性配色，鲜明对比，8种颜色
- **适用场景**: 
  - 需要强调不同概率区间的场合
  - 分段式数据展示
  - 高对比度可视化需求
  - 需要明确区分数据范围
- **优点**: 
  - 颜色鲜明，对比度高
  - 经典配色，广泛认知
  - 易于区分不同数值区间
  - 适合强调分类特征
- **缺点**: 
  - 分段效果明显，不连续
  - 可能过于鲜艳
  - 不适合需要平滑渐变的场合
- **重要说明**: 定性配色会产生明显的分段效果，适合需要强调不同概率区间的应用

### 3. Set2配色方案（备选 - 柔和定性配色）
- **配置**: `standard_cmap = "Set2"`
- **特征**: 柔和定性配色，视觉舒适，8种颜色
- **适用场景**:
  - 专业报告和演示
  - 需要长时间观看的场合
  - 柔和视觉效果需求
- **优点**: 颜色柔和，视觉舒适，专业感强，适合长时间观看
- **缺点**: 分段效果存在，对比度中等

### 4. YlOrRd配色方案（连续配色 - 白色背景）
- **配置**: `standard_cmap = "YlOrRd"`
- **特征**: 黄色-橙色-红色渐变，白色背景
- **适用场景**: 
  - 科技报告和学术论文
  - 需要连续渐变效果
  - 打印输出友好
  - 白色背景需求
- **优点**: 
  - 白色背景，适合打印和学术发表
  - 连续渐变，数据表示自然
  - 高对比度，视觉效果好
  - 在黑白打印时仍能保持良好对比度
- **缺点**: 在某些情况下可能过于鲜艳

### 5. Reds配色方案（经典连续 - 白色背景）
- **配置**: `standard_cmap = "Reds"`
- **特征**: 白色到红色渐变
- **适用场景**:
  - 经典科技报告
  - 学术论文标准配色
  - 保守的可视化需求
- **优点**: 经典科技配色，白色背景，打印效果好，广泛认知
- **缺点**: 单色调，缺少颜色变化

## 配色方案类型说明

### 定性配色方案 (Qualitative Colormaps)
- **特点**: 设计用于分类数据，颜色之间无自然顺序
- **效果**: 在连续PPSD数据中产生明显的分段效果
- **适用**: 需要强调不同概率区间或数据范围的场合
- **推荐**: Set1, Set2, Paired, tab10
- **注意**: 可能会误导数据的连续性解释

### 连续配色方案 (Sequential Colormaps)
- **特点**: 设计用于连续数据，颜色有自然的渐变过渡
- **效果**: 平滑的颜色渐变，适合连续概率密度数据
- **适用**: 标准PPSD可视化，科学数据展示
- **推荐**: YlOrRd, Reds, Blues, plasma, viridis
- **优点**: 数据表示自然，符合科学可视化标准

## 配置建议

### 如果您需要最佳PPSD可视化效果（强烈推荐）：
```toml
standard_cmap = "viridis_custom"    # 首选：去除深色，突出中高值，科学标准
# 或者
standard_cmap = "ocean_custom"      # 备选：蓝绿色调，海洋主题
# 或者
standard_cmap = "plasma_custom"     # 备选：现代感强，高对比度
```

### 如果您需要定性配色效果：
```toml
standard_cmap = "Set1"      # 推荐：经典定性配色，鲜明对比
# 或者
standard_cmap = "Set2"      # 备选：柔和定性配色，视觉舒适
# 或者
standard_cmap = "Paired"    # 备选：成对配色，层次丰富
```

### 如果您需要连续渐变效果：
```toml
standard_cmap = "YlOrRd"    # 推荐：白色背景，黄-橙-红渐变
# 或者
standard_cmap = "Reds"      # 备选：经典白色背景，白-红渐变
# 或者
standard_cmap = "plasma"    # 备选：紫-蓝-绿-黄-红渐变
```

## 重要说明

⚠️ **定性配色方案的特点和限制**:
- 定性配色方案设计用于分类数据，不是连续数据
- 在PPSD连续概率数据中会产生明显的分段效果
- 颜色之间没有自然的渐变过渡
- 可能会误导数据的连续性解释

✅ **如果您确实需要定性配色效果**:
- 可以用于强调不同的概率区间
- 适合需要明确区分数据范围的场合
- 建议配合详细的图例说明
- 适合分类式数据解读需求

🔄 **替代建议**:
- 如需连续渐变：推荐使用YlOrRd, Reds, Blues等连续配色
- 如需分段效果：可以考虑使用定性配色方案
- 如需打印友好：推荐白色背景的配色方案

## 测试工具

项目提供了配色方案对比工具，帮助您选择最适合的配色：

```bash
# 自定义配色方案对比（新增 - 推荐）
python tests/custom_colormap_comparison.py

# 定性配色方案对比
python tests/qualitative_colormap_comparison.py

# 白色背景配色方案对比  
python tests/white_background_colormap_comparison.py

# 科学配色方案对比
python tests/ppsd_colormap_comparison.py
```

## 版本历史

- **v1.4**: 添加自定义配色方案支持 (viridis_custom, ocean_custom, plasma_custom等6个优化配色)
- **v1.3**: 添加定性配色方案支持 (Set1, Set2, Paired等)
- **v1.2**: 添加白色背景配色方案 (YlOrRd, Reds, Blues等)
- **v1.1**: 添加科学配色方案 (plasma, viridis, jet等)
- **v1.0**: 基础配色方案支持

---

# 皮特森曲线样式配置说明

## 概述

皮特森曲线（Peterson Curves）包括NLNM（新低噪声模型）和NHNM（新高噪声模型），是地震学中用于评估台站噪声水平的重要参考线。本系统支持完全自定义皮特森曲线的视觉样式。

## 配置参数

### 基础样式参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| `peterson_color` | 字符串 | `"black"` | 皮特森曲线统一颜色（NLNM和NHNM） |
| `peterson_linewidth` | 浮点数 | `1.5` | 皮特森曲线线宽 |
| `peterson_linestyle` | 字符串 | `"-"` | 皮特森曲线线型 |
| `peterson_alpha` | 浮点数 | `0.9` | 皮特森曲线透明度（0.0-1.0） |

### 高级样式参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| `peterson_nlnm_color` | 字符串 | `peterson_color` | NLNM曲线单独颜色设置 |
| `peterson_nhnm_color` | 字符串 | `peterson_color` | NHNM曲线单独颜色设置 |

## 配置示例

### 1. 科学论文样式（推荐）
```toml
# 皮特森曲线样式配置 - 科学论文
peterson_color = "gray"
peterson_linewidth = 1.0
peterson_linestyle = "-"
peterson_alpha = 0.7
```

### 2. 彩色区分样式
```toml
# 皮特森曲线样式配置 - 彩色区分
peterson_nlnm_color = "green"      # NLNM绿色
peterson_nhnm_color = "red"        # NHNM红色
peterson_linewidth = 1.5
peterson_linestyle = "--"
peterson_alpha = 0.8
```

### 3. 低调背景样式
```toml
# 皮特森曲线样式配置 - 低调背景
peterson_color = "lightgray"
peterson_linewidth = 0.8
peterson_linestyle = ":"
peterson_alpha = 0.6
```

### 4. 强调显示样式
```toml
# 皮特森曲线样式配置 - 强调显示
peterson_color = "red"
peterson_linewidth = 2.5
peterson_linestyle = "-"
peterson_alpha = 0.9
```

## 参数详细说明

### 颜色参数 (Color)
支持matplotlib所有颜色格式：

#### 颜色名称
```toml
peterson_color = "red"          # 红色
peterson_color = "blue"         # 蓝色
peterson_color = "green"        # 绿色
peterson_color = "black"        # 黑色
peterson_color = "gray"         # 灰色
peterson_color = "lightgray"    # 浅灰色
```

#### 十六进制颜色
```toml
peterson_color = "#FF0000"      # 红色
peterson_color = "#0000FF"      # 蓝色
peterson_color = "#008000"      # 绿色
```

#### RGB元组（需要特殊格式）
```toml
# 注意：TOML不直接支持元组，需要使用字符串表示
peterson_color = "red"          # 推荐使用颜色名称
```

### 线型参数 (Line Style)
```toml
peterson_linestyle = "-"        # 实线（默认）
peterson_linestyle = "--"       # 虚线
peterson_linestyle = "-."       # 点划线
peterson_linestyle = ":"        # 点线
```

### 线宽参数 (Line Width)
```toml
peterson_linewidth = 0.5        # 极细线
peterson_linewidth = 1.0        # 细线
peterson_linewidth = 1.5        # 标准线宽（默认）
peterson_linewidth = 2.0        # 粗线
peterson_linewidth = 3.0        # 极粗线
```

**线宽建议**：
- `0.5-1.0`: 细线，适合背景参考
- `1.0-2.0`: 标准线宽，适合一般用途
- `2.0-3.0`: 粗线，适合强调显示

### 透明度参数 (Alpha)
```toml
peterson_alpha = 0.3            # 高透明度
peterson_alpha = 0.5            # 中等透明度
peterson_alpha = 0.7            # 低透明度
peterson_alpha = 0.9            # 几乎不透明（默认）
peterson_alpha = 1.0            # 完全不透明
```

## 使用场景推荐

### 📊 科学论文发表
```toml
# 适合学术期刊的保守样式
peterson_color = "black"
peterson_linewidth = 1.0
peterson_linestyle = "-"
peterson_alpha = 0.8
```

### 🎨 演示展示
```toml
# 适合会议演示的醒目样式
peterson_nlnm_color = "blue"
peterson_nhnm_color = "red"
peterson_linewidth = 2.0
peterson_linestyle = "--"
peterson_alpha = 0.9
```

### 📈 数据分析
```toml
# 适合日常分析的清晰样式
peterson_color = "gray"
peterson_linewidth = 1.2
peterson_linestyle = "-"
peterson_alpha = 0.7
```

### 🖨️ 打印输出
```toml
# 适合黑白打印的样式
peterson_color = "black"
peterson_linewidth = 1.5
peterson_linestyle = "-"
peterson_alpha = 1.0
```

## 技术说明

### 自动检测机制
系统会自动检测配置文件中是否包含任何皮特森曲线自定义参数。如果检测到，将使用自定义样式；否则使用ObsPy默认样式。

### 兼容性
- ✅ 完全向后兼容现有配置
- ✅ 与百分位数线自定义功能协同工作
- ✅ 支持单个PPSD和合并PPSD绘图模式
- ✅ 支持所有绘图类型（standard, temporal, spectrogram）

### 数据来源
- 使用ObsPy标准函数：`get_nlnm()`和`get_nhnm()`
- 数据长度：1001个点
- 周期范围：0.1 - 100,000秒
- PSD范围：NLNM (-187.5 to -103.1 dB), NHNM (-138.5 to -48.5 dB)

## 测试验证

可以使用以下命令测试皮特森曲线功能：

```bash
# 基础功能测试
python tests/test_peterson_curves.py

# 完整绘图测试
python run_cp_ppsd.py input/config_plot.toml
```

## 注意事项

1. **参数优先级**：`peterson_nlnm_color`和`peterson_nhnm_color`会覆盖`peterson_color`
2. **性能影响**：自定义样式会略微增加绘图时间，但影响很小
3. **图层顺序**：皮特森曲线使用`zorder=15`，确保在PPSD直方图之上显示
4. **错误处理**：单个曲线绘制失败不会影响其他曲线的显示

## 版本历史

- **v1.5**: 添加皮特森曲线自定义样式支持 (peterson_color, peterson_linewidth等6个参数)
- **v1.4**: 添加自定义配色方案支持 (viridis_custom, ocean_custom, plasma_custom等6个优化配色)
- **v1.3**: 添加定性配色方案支持 (Set1, Set2, Paired等)
- **v1.2**: 添加白色背景配色方案 (YlOrRd, Reds, Blues等)
- **v1.1**: 添加科学配色方案 (plasma, viridis, jet等)
- **v1.0**: 基础配色方案支持 