# 皮特森曲线参数优化报告

## 修改概述

根据用户要求，对皮特森曲线配置参数进行了优化，移除了冗余的`peterson_color`参数，简化了配置结构。

## 具体修改

### 1. 配置文件修改 (`input/config_plot.toml`)

**删除的参数**：
```toml
peterson_color = "red"              # 皮特森曲线颜色 (NLNM和NHNM使用相同颜色)
```

**保留的参数**：
```toml
# 皮特森曲线样式配置（自定义参数）
peterson_linewidth = 1.0           # 皮特森曲线线宽
peterson_linestyle = "--"           # 皮特森曲线线型 ("-", "--", "-.", ":")
peterson_alpha = 0.8               # 皮特森曲线透明度 (0.0-1.0)
peterson_nlnm_color = "red"        # NLNM曲线颜色
peterson_nhnm_color = "red"        # NHNM曲线颜色
```

### 2. 代码逻辑修改 (`cp_ppsd/cp_psd.py`)

**修改前的逻辑**：
```python
# 获取自定义样式参数
peterson_color = args.get('peterson_color', 'black')
# 单独的NLNM和NHNM颜色设置（如果提供）
nlnm_color = args.get('peterson_nlnm_color', peterson_color)
nhnm_color = args.get('peterson_nhnm_color', peterson_color)
```

**修改后的逻辑**：
```python
# 获取NLNM和NHNM颜色设置（必须单独指定）
nlnm_color = args.get('peterson_nlnm_color', 'black')
nhnm_color = args.get('peterson_nhnm_color', 'black')
```

**检测逻辑更新**：
移除了两处对`'peterson_color' in args`的检查，简化了自定义皮特森曲线样式的检测逻辑。

## 优化效果

- [优化] 移除了冗余的`peterson_color`参数
- [改进] 用户可以直接通过`peterson_nlnm_color`和`peterson_nhnm_color`控制颜色
- [简化] 如果需要相同颜色，只需将两个参数设置为相同值

### 代码简化
- [优化] 移除了对`peterson_color`的依赖
- [改进] 简化了颜色获取逻辑
- [减少] 减少了参数检测的复杂度

### 3. 功能验证

**日志输出确认**：
```
NLNM样式: color=red, linewidth=1.0, linestyle=--, alpha=0.8
NHNM样式: color=red, linewidth=1.0, linestyle=--, alpha=0.8
```

**生成的图片文件**：
- `standard_merged_202503251600-202503261430_BJ-DAX-00-BHZ.png` (90KB)
- `standard_merged_202503251600-202503261430_BJ-FHY-00-BHZ.png` (76KB)
- `standard_merged_202503251600-202503261500_BJ-JIZ-00-SHZ.png` (94KB)
- `standard_merged_202503251600-202503261500_BJ-DSQ-00-SHZ.png` (89KB)

## 使用指南

### 相同颜色配置
如果用户希望NLNM和NHNM使用相同颜色：
```toml
peterson_nlnm_color = "red"
peterson_nhnm_color = "red"
```

### 不同颜色配置
如果用户希望NLNM和NHNM使用不同颜色：
```toml
peterson_nlnm_color = "blue"
peterson_nhnm_color = "red"
```

### 默认行为
如果不指定颜色参数，两条曲线都将使用黑色：
```python
nlnm_color = args.get('peterson_nlnm_color', 'black')
nhnm_color = args.get('peterson_nhnm_color', 'black')
```

## 兼容性保证

- [兼容] 现有的`peterson_nlnm_color`和`peterson_nhnm_color`参数完全保持
- [保持] 所有其他皮特森曲线样式参数保持不变
- [一致] 功能行为完全一致

### 配置迁移
对于使用旧配置的用户：
1. 删除`peterson_color`参数
2. 确保`peterson_nlnm_color`和`peterson_nhnm_color`设置为期望的颜色
3. 如果希望相同颜色，将两个参数设置为相同值

## 总结

此次优化成功简化了皮特森曲线的配置结构：

1. **配置更直观**：用户直接控制每条曲线的颜色，无需理解参数优先级
2. **代码更简洁**：移除了冗余的参数处理逻辑
3. **功能完整**：保持所有现有功能，包括位置修复和样式自定义
4. **用户友好**：支持相同颜色和不同颜色的灵活配置

修改完全满足用户需求，提供了更清晰、更直接的皮特森曲线颜色控制方式。 